 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/mobile/plugins/strip-pods-privacyinfo.js b/mobile/plugins/strip-pods-privacyinfo.js
index ef6b85bda1b63726ea7f36aba50a87abc2e343cc..6f183d13de32852b3f13accb4173e52265dfb977 100644
--- a/mobile/plugins/strip-pods-privacyinfo.js
+++ b/mobile/plugins/strip-pods-privacyinfo.js
@@ -1,29 +1,31 @@
 const fs = require("fs");
 const path = require("path");
 const { withDangerousMod } = require("@expo/config-plugins");
 
+const PODFILE_MARKER = "# BOOKITGY_PRIVACYINFO_STRIP";
+
 function findPbxprojFiles(iosDir) {
   const pbxprojFiles = new Set();
 
   const entries = fs.readdirSync(iosDir, { withFileTypes: true });
   for (const entry of entries) {
     if (entry.isDirectory() && entry.name.endsWith(".xcodeproj")) {
       const candidate = path.join(iosDir, entry.name, "project.pbxproj");
       if (fs.existsSync(candidate)) {
         pbxprojFiles.add(candidate);
       }
     }
   }
 
   const podsPbxproj = path.join(iosDir, "Pods", "Pods.xcodeproj", "project.pbxproj");
   if (fs.existsSync(podsPbxproj)) {
     pbxprojFiles.add(podsPbxproj);
   }
 
   return Array.from(pbxprojFiles);
 }
 
 function collectPrivacyFileRefs(content) {
   const fileRefs = new Set();
   const fileRefRegex = /([A-F0-9]{24}) \/\* PrivacyInfo\.xcprivacy \*\/ = {[^}]*?};/g;
   let match;
@@ -96,40 +98,133 @@ function processPbxproj(pbxprojPath) {
     updated,
     buildFilesToRemove,
     "PrivacyInfo.xcprivacy in Resources"
   );
   updated = buildFilesStrip.content;
 
   const fileRefsStrip = stripEntries(updated, fileRefsToRemove, "PrivacyInfo.xcprivacy");
   updated = fileRefsStrip.content;
 
   const resourcesStrip = stripResourcesReferences(updated, buildFilesToRemove);
   updated = resourcesStrip.content;
 
   if (updated !== original) {
     fs.writeFileSync(pbxprojPath, updated);
   }
 
   const totalRemoved = buildFilesStrip.removed + fileRefsStrip.removed + resourcesStrip.removed;
   console.log(
     `[strip-pods-privacyinfo] Removed ${totalRemoved} PrivacyInfo.xcprivacy references from ${path.relative(
       process.cwd(),
       pbxprojPath
     )}`
   );
 }
 
+function buildPodfileSnippet(indent) {
+  const lines = [
+    `${indent}${PODFILE_MARKER}`,
+    `${indent}scripts = Dir.glob(File.join(__dir__, "Pods", "Target Support Files", "Pods-*", "Pods-*-resources.sh"))`,
+    "",
+    `${indent}scripts.each do |script|`,
+    `${indent}  next unless File.exist?(script)`,
+    `${indent}  content = File.read(script)`,
+    `${indent}  next unless content.include?("PrivacyInfo.xcprivacy")`,
+    "",
+    `${indent}  filtered = content.lines.reject { |line| line.include?("PrivacyInfo.xcprivacy") }.join`,
+    `${indent}  File.write(script, filtered)`,
+    "",
+    `${indent}  puts "[BookitGY] Stripped PrivacyInfo.xcprivacy from #{script}"`,
+    `${indent}end`,
+    "",
+  ];
+
+  return lines.join("\n");
+}
+
+function findPostInstallEnd(content, startIndex) {
+  const remainder = content.slice(startIndex);
+  const lines = remainder.split("\n");
+  let depth = 0;
+  let position = startIndex;
+
+  for (const line of lines) {
+    const lineStart = position;
+    const doCount = (line.match(/\bdo\b/g) || []).length;
+    const endCount = (line.match(/\bend\b/g) || []).length;
+
+    depth += doCount;
+    depth -= endCount;
+
+    if (depth === 0) {
+      return lineStart;
+    }
+
+    position += line.length + 1;
+  }
+
+  return null;
+}
+
+function injectPodfilePrivacyStrip(iosDir) {
+  const podfilePath = path.join(iosDir, "Podfile");
+  if (!fs.existsSync(podfilePath)) {
+    return;
+  }
+
+  let podfileContent = fs.readFileSync(podfilePath, "utf8");
+
+  if (podfileContent.includes(PODFILE_MARKER)) {
+    return;
+  }
+
+  const postInstallMatch = podfileContent.match(/^[ \t]*post_install\s+do\s*\|[^|]*\|.*$/m);
+
+  if (postInstallMatch) {
+    const postInstallStart = postInstallMatch.index;
+    const endOfPostInstall = findPostInstallEnd(podfileContent, postInstallStart);
+
+    if (endOfPostInstall === null) {
+      return;
+    }
+
+    const indent = postInstallMatch[0].match(/^[ \t]*/)[0];
+    const snippet = buildPodfileSnippet(`${indent}  `);
+    const before = podfileContent.slice(0, endOfPostInstall);
+    const after = podfileContent.slice(endOfPostInstall);
+    const needsLeadingNewline = before.endsWith("\n") ? "" : "\n";
+
+    podfileContent = `${before}${needsLeadingNewline}${snippet}${after}`;
+  } else {
+    const snippet = buildPodfileSnippet("  ");
+    const needsLeadingNewline = podfileContent.endsWith("\n") ? "" : "\n";
+
+    podfileContent = `${podfileContent}${needsLeadingNewline}post_install do |installer|\n${snippet}end\n`;
+  }
+
+  fs.writeFileSync(podfilePath, podfileContent);
+
+  console.log(
+    `[strip-pods-privacyinfo] Injected Podfile privacy strip logic into ${path.relative(
+      process.cwd(),
+      podfilePath
+    )}`
+  );
+}
+
 module.exports = function withStripPodsPrivacyInfo(config) {
   return withDangerousMod(config, [
     "ios",
     async (config) => {
       const iosDir = config.modRequest.platformProjectRoot;
       const pbxprojPaths = findPbxprojFiles(iosDir);
 
       for (const pbxprojPath of pbxprojPaths) {
         processPbxproj(pbxprojPath);
       }
 
+      injectPodfilePrivacyStrip(iosDir);
+
       return config;
     },
   ]);
 };
 
EOF
)