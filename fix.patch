 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/backend/tests/test_booking_status_rules.py b/backend/tests/test_booking_status_rules.py
index 3277ab52f4ba897fd76472e3535545fbc1c8afa1..71930d9793c3d2acd31f381ca2044a1bce72cefc 100644
--- a/backend/tests/test_booking_status_rules.py
+++ b/backend/tests/test_booking_status_rules.py
@@ -141,50 +141,52 @@ def test_billing_only_counts_completed(db_session):
         start_time=past_start - timedelta(hours=2),
         end_time=past_end - timedelta(hours=2),
         status="confirmed",
     )
 
     _add_booking(
         session,
         models,
         customer=customer,
         service=service,
         start_time=past_start - timedelta(hours=4),
         end_time=past_end - timedelta(hours=4),
         status="cancelled",
     )
 
     _add_booking(
         session,
         models,
         customer=customer,
         service=service,
         start_time=future_start,
         end_time=future_end,
         status="confirmed",
     )
 
+    crud._auto_complete_finished_bookings(session, as_of=now)
+
     billable = crud.get_billable_bookings_for_provider(
         session, provider.id, as_of=now
     )
 
     session.refresh(completed_booking)
     session.refresh(past_confirmed_booking)
 
     # The confirmed past booking should auto-complete; only completed entries count.
     assert {b["id"] for b in billable} == {
         completed_booking.id,
         past_confirmed_booking.id,
     }
     assert completed_booking.status == "completed"
     assert past_confirmed_booking.status == "completed"
 
 
 def test_cannot_cancel_completed_bookings(db_session):
     session, models, crud = db_session
     provider, customer, service = _create_provider_graph(session, models)
 
     now = now_guyana()
     start_time = now + timedelta(hours=1)
     end_time = start_time + timedelta(hours=1)
 
     active_booking = _add_booking(
 
EOF
)