 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/backend/app/routes/users.py b/backend/app/routes/users.py
index dc87f4ffe4604faf3f998fbf7106ad2bc739350a..e6a8d65b9fe7c119a6ce8d95e77308d9e556c411 100644
--- a/backend/app/routes/users.py
+++ b/backend/app/routes/users.py
@@ -74,50 +74,55 @@ def _validate_client_image(contents: bytes) -> None:
             detail="Avatar image dimensions are too large.",
         )
 
 
 @router.get("/users/me")
 def read_users_me(
     current_user: models.User = Depends(get_current_user_from_header),
 ):
     return current_user
 
 
 
 
 @router.put("/users/me")
 def update_users_me(
     user_update: schemas.UserUpdate,
     db: Session = Depends(get_db),
     current_user: models.User = Depends(get_current_user_from_header),
 ):
     """
     Partially update the current user.
     Only fields that are actually sent by the client are changed.
     """
     try:
         updated_user = crud.update_user(db, current_user.id, user_update)
+    except ValueError as exc:
+        raise HTTPException(
+            status_code=status.HTTP_400_BAD_REQUEST,
+            detail=str(exc),
+        )
     except SQLAlchemyError as e:
         # This will show up in `docker compose logs backend`
         print("ERROR updating user in /users/me:", repr(e))
         traceback.print_exc()
         raise HTTPException(
             status_code=500,
             detail="Database error while updating user profile.",
         )
 
     if updated_user is None:
         raise HTTPException(status_code=404, detail="User not found")
 
     return updated_user
 
 @router.post("/users/me/avatar")
 async def upload_my_avatar(
     file: UploadFile = File(...),
     db: Session = Depends(get_db),
     current_user: models.User = Depends(get_current_user_from_header),
 ):
     """
     Upload/update avatar for the *current user* (clients or providers).
 
     Stores the Cloudinary URL in users.avatar_url.
     """
@@ -157,26 +162,25 @@ async def upload_my_avatar(
         )
     finally:
         try:
             os.remove(tmp_path)
         except Exception:
             pass
 
     secure_url = (
         upload_result.get("secure_url")
         if isinstance(upload_result, dict)
         else str(upload_result)
     )
 
     if not secure_url:
         raise HTTPException(
             status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
             detail="Avatar upload did not return a valid URL",
         )
 
     current_user.avatar_url = secure_url
     db.commit()
     db.refresh(current_user)
 
     return {"avatar_url": secure_url}
 
-
 
EOF
)