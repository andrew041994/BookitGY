 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/backend/app/crud.py b/backend/app/crud.py
index bff9fffff4a14b3eaf541dfcff056ef5f4485b1c..a688e6b05cdb7ad7e0679ccf5ab429f699f6913c 100644
--- a/backend/app/crud.py
+++ b/backend/app/crud.py
@@ -1726,91 +1726,109 @@ def get_provider_platform_fee_for_cycle(
 
     services_total = Decimal("0")
     for r in rows:
         if _is_cancelled_status(r.status):
             continue
         if normalized_booking_status_value(r.status) != "completed":
             continue
 
         price = r.service_price_gyd or 0
         services_total += Decimal(str(price))
 
     if services_total <= 0:
         return 0.0
 
     service_charge_pct = get_platform_service_charge_percentage(db)
     fee_rate = Decimal(str(max(service_charge_pct, 0))) / Decimal("100")
     platform_fee = services_total * fee_rate
 
     platform_fee = platform_fee.quantize(Decimal("1"))
     if platform_fee <= 0:
         return 0.0
 
     return float(platform_fee)
 
 
+def _normalize_cycle_month(value: date | datetime) -> date:
+    """Return billing month anchored to the first day (YYYY-MM-01)."""
+
+    if isinstance(value, datetime):
+        value = value.date()
+    return date(value.year, value.month, 1)
 
 
 def _provider_billing_row(
     db: Session, provider: models.Provider, user: models.User, cycle_month: date
 ):
+    cycle_month = _normalize_cycle_month(cycle_month)
+    current_cycle_month = _normalize_cycle_month(current_billing_cycle_month())
+
     billing_cycle = get_billing_cycle_for_account(db, provider.account_number, cycle_month)
     bill = (
         db.query(models.Bill)
         .filter(
             models.Bill.provider_id == provider.id,
             models.Bill.month == cycle_month,
         )
         .first()
     )
 
-    amount_due = get_provider_fees_due_for_cycle(db, provider.id, cycle_month)
     is_paid = bool(billing_cycle.is_paid) if billing_cycle else False
     paid_at = billing_cycle.paid_at if billing_cycle else None
     credits_applied = (
         Decimal(str(billing_cycle.credits_applied_gyd or 0))
         if billing_cycle
         else Decimal("0")
     )
+
+    if bill and cycle_month < current_cycle_month:
+        amount_due = Decimal(str(bill.fee_gyd or 0)) - credits_applied
+        if amount_due < 0:
+            amount_due = Decimal("0")
+    else:
+        amount_due = Decimal(
+            str(get_provider_fees_due_for_cycle(db, provider.id, cycle_month) or 0)
+        )
+
     if bill and bill.due_date:
         last_due_date = bill.due_date
     else:
         if cycle_month.month == 12:
             due_year = cycle_month.year + 1
             due_month = 1
         else:
             due_year = cycle_month.year
             due_month = cycle_month.month + 1
         last_due_date = datetime(due_year, due_month, 15, 23, 59)
 
     return {
         "provider_id": provider.id,
         "user_id": user.id,
         "name": get_display_name(user),
         "account_number": provider.account_number or "",
         "phone": user.phone or "",
-        "amount_due_gyd": float(amount_due or 0.0),
+        "amount_due_gyd": float(amount_due),
         "bill_credits_gyd": float(credits_applied),
         "cycle_month": cycle_month,
         "is_paid": is_paid,
         "is_locked": bool(getattr(provider, "is_locked", False)),
         "is_suspended": bool(getattr(user, "is_suspended", False)),
         "last_due_date": last_due_date,
         "paid_at": paid_at,
     }
 
 
 def list_provider_billing_rows(db: Session, cycle_month: date):
     rows = (
         db.query(models.Provider, models.User)
         .join(models.User, models.Provider.user_id == models.User.id)
         .all()
     )
 
     account_numbers = [
         provider.account_number
         for provider, _user in rows
         if provider.account_number
     ]
     ensure_billing_cycles_for_accounts(db, account_numbers, cycle_month)
 
     return [
 
EOF
)