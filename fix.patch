 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/mobile/App.js b/mobile/App.js
index 771c972d3d79fe5360a7c17cf744fe96fcf76320..4c9143cfd4ec4f0b72eec7dd7ee6cc81e0575568 100644
--- a/mobile/App.js
+++ b/mobile/App.js
@@ -6078,113 +6078,118 @@ function App() {
       if (typeof text.detail === "string") return text.detail;
       if (typeof text.message === "string") return text.message;
       if (typeof text.msg === "string") return text.msg;
       return JSON.stringify(text);
     }
 
     return String(text);
   };
 
   const showFlash = (type, text) => {
     setFlash({ type, text: formatFlashText(text) });
     setTimeout(() => {
       setFlash(null);
     }, 4500);
   };
 
   useEffect(() => {
     tokenRef.current = token;
   }, [token]);
 
   useEffect(() => {
     let isActive = true;
 
     Linking.getInitialURL().then((url) => {
       if (!isActive) return;
-      const didNavigate = false;
+      let didNavigate = false;
       console.log("[deeplink] received initial url", url);
       const username = extractUsernameFromUrl(url);
       console.log("[deeplink] extracted username", username);
+      if (username) {
+        if (tokenRef.current && !tokenRef.current.isProvider) {
+          didNavigate = navigateToClientSearch(username, navigationRef);
+          setPendingDeepLinkUsername(null);
+        } else {
+          setPendingDeepLinkUsername({ username, nonce: Date.now() });
+        }
+      }
       console.log(
         "[deeplink] initial url",
         url,
         "username",
         username,
         "immediateNavigate",
         didNavigate
       );
-      if (username) {
-        setPendingDeepLinkUsername(username);
-      }
     });
 
     const sub = Linking.addEventListener("url", ({ url }) => {
       let didNavigate = false;
       console.log("[deeplink] received url event", url);
       const username = extractUsernameFromUrl(url);
       console.log("[deeplink] extracted username", username);
       if (username) {
         if (tokenRef.current && !tokenRef.current.isProvider) {
           didNavigate = navigateToClientSearch(username, navigationRef);
           setPendingDeepLinkUsername(null);
         } else {
-          setPendingDeepLinkUsername(username);
+          setPendingDeepLinkUsername({ username, nonce: Date.now() });
         }
       }
       console.log(
         "[deeplink] url event",
         url,
         "username",
         username,
         "immediateNavigate",
         didNavigate
       );
     });
 
     return () => {
       isActive = false;
       sub.remove();
     };
   }, []);
 
   useEffect(() => {
     if (!pendingDeepLinkUsername || !token) return;
 
     if (token.isProvider) {
       console.log(
         "[deeplink] provider user ignoring username",
         pendingDeepLinkUsername
       );
       if (showFlash) {
         showFlash("error", "Open as a client to view provider links.");
       }
       setPendingDeepLinkUsername(null);
       return;
     }
 
     const didNavigate = navigateToClientSearch(
-      pendingDeepLinkUsername,
+      pendingDeepLinkUsername.username,
       navigationRef
     );
     console.log(
       "[deeplink] pending username",
       pendingDeepLinkUsername,
       "navigate",
       didNavigate
     );
     setPendingDeepLinkUsername(null);
   }, [pendingDeepLinkUsername, token, showFlash]);
 
   useEffect(() => {
     let isActive = true;
     const restoreSession = async () => {
       if (authBootstrapRef.current.inFlight || authBootstrapRef.current.completed) {
         return;
       }
       authBootstrapRef.current.inFlight = true;
       const bootstrapStartedAt = Date.now();
       console.log("[auth] bootstrap start");
       try {
         const restoredToken = await withTimeout(
           getAuthToken(),
           AUTH_TOKEN_TIMEOUT_MS,
           "getAuthToken"
 
EOF
)