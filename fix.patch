 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/backend/app/crud.py b/backend/app/crud.py
index a7dd5aa12d002217f56692764d0c2b8326fe16ee..4e9f37bd316453d5a375e597df52adc8e73bc146 100644
--- a/backend/app/crud.py
+++ b/backend/app/crud.py
@@ -1689,66 +1689,86 @@ def list_provider_billing_cycles(
         else:
             status = "Generated"
 
         cycles.append(
             {
                 "cycle_month": cycle_month,
                 "coverage_start": cycle_month,
                 "coverage_end": coverage_end,
                 "invoice_date": invoice_date,
                 "status": status,
                 "services_total_gyd": float(services_total),
                 "platform_fee_gyd": float(platform_fee),
                 "bill_credits_gyd": float(bill_credits),
                 "total_due_gyd": float(total_due),
                 "items": items,
             }
         )
 
     return {
         "account_number": account_number,
         "outstanding_fees_gyd": outstanding_fees,
         "cycles": cycles,
     }
 
 
-def set_provider_bills_paid_state(db: Session, provider_id: int, is_paid: bool) -> int:
+def set_provider_bills_paid_state(
+    db: Session,
+    provider_id: int,
+    month: date,
+    is_paid: bool,
+) -> int:
     provider = (
         db.query(models.Provider)
         .filter(models.Provider.id == provider_id)
         .first()
     )
     if not provider or not provider.account_number:
         return 0
 
-    cycle_month = current_billing_cycle_month()
+    cycle_month = date(month.year, month.month, 1)
     billing_cycle = get_or_create_billing_cycle(db, provider.account_number, cycle_month)
     if not billing_cycle:
         return 0
 
     billing_cycle.is_paid = bool(is_paid)
     billing_cycle.paid_at = now_guyana() if is_paid else None
+    bill_updates = {models.Bill.is_paid: bool(is_paid)}
+    bill_paid_at = getattr(models.Bill, "paid_at", None)
+    bill_paid_on = getattr(models.Bill, "paid_on", None)
+    if bill_paid_at is not None:
+        bill_updates[bill_paid_at] = now_guyana() if is_paid else None
+    if bill_paid_on is not None:
+        bill_updates[bill_paid_on] = now_guyana().date() if is_paid else None
+    (
+        db.query(models.Bill)
+        .filter(
+            models.Bill.provider_id == provider_id,
+            models.Bill.month == cycle_month,
+        )
+        .update(bill_updates, synchronize_session="fetch")
+    )
     db.commit()
     return 1
 
 
 def current_billing_cycle_month(reference: datetime | date | None = None) -> date:
     if reference is None:
         reference = now_guyana()
     if isinstance(reference, datetime):
         reference = reference.date()
     return date(reference.year, reference.month, 1)
 
 
 def get_billing_cycle_for_account(
     db: Session, account_number: str | None, cycle_month: date
 ) -> Optional[models.BillingCycle]:
     if not account_number:
         return None
     return (
         db.query(models.BillingCycle)
         .filter(
             models.BillingCycle.account_number == account_number,
             models.BillingCycle.cycle_month == cycle_month,
         )
         .first()
     )
 
EOF
)